# Vowel-Manipulation (`textgrid-ui` branch)

Dan Villarreal (New Zealand Institute of Language, Brain, and Behaviour)

daniel.villarreal@canterbury.ac.nz | https://canterbury-nz.academia.edu/DanVillarreal | https://www.researchgate.net/profile/Dan_Villarreal


This repository contains files useful for replicating the vowel manipulation methods used in my [2016 dissertation](https://www.academia.edu/30182487). If citing these scripts, please cite my [2018 *Journal of English Linguistics* article](http://journals.sagepub.com/doi/full/10.1177/0075424217753520): Villarreal, Dan. 2018. The construction of social meaning: A matched-guise investigation of the California Vowel Shift. *Journal of English Linguistics* 46.1.52-78. doi:10.1177/0075424217753520

The `textgrid-ui` branch is being built to support a more user-friendly workflow than is available in the `master` branch. Here's what's available:

## `ManipTextgrid.praat`

`ManipTextgrid.praat` allows the user to manipulate a Sound through a Praat window. First, select a Sound and accompanying TextGrid, then run the script. Then, a Praat window will ask the user to specify a number of settings:
- **Segment tier** and **Search string (regex)**: The script will look for labels matching the search string on the segment tier; intervals with a matching label will be manipulated, and all others ignored. The search string can either be a string literal or a [Praat regular expression](http://www.fon.hum.uva.nl/praat/manual/Regular_expressions.html). For example, if you have a phoneme tier generated by [FAVE-Align](https://github.com/JoFrhwld/FAVE/wiki/FAVE-align) and you want to manipulate all tokens of primary-stressed TRAP (aka short-a or /æ/), search for `AE1`; if you want primary and secondary-stressed TRAP, search for `AE[12]`. If you've marked off vowels to be manipulated in a separate tier, `.+` finds all non-empty labels (including spaces, so be careful!).
- **Maximum frequency (Hz)** and **Number of formants**: The script uses these settings to figure out where the formants are. It's easy to set these settings incorrectly for a given sound and get really weird results; in fact, the optimal settings may differ from token to token, even for the same vowel. Trial and error is the best way to determine the right settings.
- **Manipulation method**: Choose whether to manipulate vowels based on a relative target (e.g., increase all F1 by 60 Hz and decrease all F2 by 120 Hz) or an absolute target (e.g., set all F3 to 2780 Hz).
- **Individual formants**: Choose which formants to manipulate (after this window is submitted, another window pops up asking for specific targets)
- **Manipulation interval** and **Start with highest formant**: The script doesn't attempt to manipulate all formants all at once, as the result is often well off the mark of the target(s) set by the user. Instead, the script goes formant-by-formant, manipulating each formant by small steps until it is acceptably close to the target before moving on to the next formant, which leads to better results. (The user can disable the iterative behavior by simply setting the manipulation interval to a sufficiently high number.) Depending on the direction of manipulation, the formant-by-formant approach can cause conflicts if one formant 'crashes' into an adjacent formant, so the user has the option of starting with the highest formant and moving down.
- **Minimum pitch (Hz)**: The script uses this setting in the procedure to clone the intensity contour of the original token onto that of the manipulated token.

After completing this window, the user is asked to specify manipulation targets for all the formants they chose to manipulate. The user may also modify **Advanced settings**: the measurement point (by default, manipulation targets are specified with respect to the midpoint, but they can instead be specified with respect to the 40% point, the 75% point, etc.), the mean intensity of the output token, settings relating to the intensity cloning and transition smoothing procedures (including the option to disable either or both), settings relating to logging information about the manipulation and saving the log to disk, and settings relating to saving the manipulated files.

After these settings windows are submitted, the script will manipulate all matching tokens by calling several lower-level scripts. On occasion, the manipulation will get stuck in an infinite loop and the user must hit <Esc> to manually kill the script; this is usually the result of a bad specification of maximum formant and number of formants. If the user has chosen to save the manipulated Sound, TextGrid, and/or logfile, this will be done automatically (including creating new subdirectories).

### Workflow

In a realistic application, you'll probably be manipulating multiple tokens with different settings (e.g., different targets for different phonemes, or different maximum formants/number of formants for different tokens), and `ManipTextgrid.praat` can't do different settings in a single run. Here's a recommended workflow for manipulating multiple tokens with different settings:
- Use trial and error by running `ManipTextgrid.praat` multiple times to determine the optimal settings for each token. 
- Once you've determined the optimal settings for each token, run `ManipTextgrid.praat` on the Sound and TextGrid using the first set of settings, then run `ManipTextgrid.praat` on the manipulated Sound and TextGrid using the next set of settings, etc., until you get the desired result. It's recommended to use the same filename prefix and suffix each time (in Advanced settings); this way, if "Write monitor to file" is set to "csv", the script will keep a running logfile with the settings for each `ManipTextgrid.praat` run, meaning you or collaborators can reproduce your results.

N.B. In the future, I'll be developing `ManipStimCSV.praat` to allow the user to manipulate multiple tokens with different settings for each token.

## Dissertation sections

`Villarreal 2016 Vowel Manipulation.pdf` contains two sections from my dissertation that explain in narrative form how the manipulation worked. The first section (3.4.3 Implementation of manipulation) provides an overview of the process. The second section (Appendix E. Implementation of acoustic manipulation), starting on p. 9, provides gory detail.

## Not present here

Not present here but also necessary for running the script are **sounds** and **textgrid files**. Of course, you can supply your own. But if you don't have any, you can access some sample stimuli from my dissertation either by [emailing me](daniel.villarreal@canterbury.ac.nz) for them, or via the [supplementary files](http://journals.sagepub.com/doi/suppl/10.1177/0075424217753520) on my [2018 JEngL article](http://journals.sagepub.com/doi/full/10.1177/0075424217753520). The stimuli I chose for this demonstration illustrate some of the pitfalls in the vowel manipulation process that the script is designed to circumvent:
- Stim5, Stim23, and Stim24 have nasty transitions between the manipulated token and a neighboring sonorant. The script automatically smooths out these transitions to make the resultant stimuli sound more natural, but you can set "Smoothing window" in the Advanced settings to `0` to see what they look like without smoothing.
- Stim5 and Stim18 have some tokens with F3s low enough such that, if nothing is done to F3, a manipulated raised F2 crashes into the F3, producing unnatural sounds (a ‘garbled’ sound for the first Stu token in Stim5, a ‘chirp’ at the end of food in Stim18). For these tokens, F3 should really be raised before manipulating F2, but you can uncheck "Start with highest formant" to see what happens when F2 is manipulatd first.
- In addition, Figure 3 from the JEngL article comes from Stim5, so readers can replicate the results shown in Figure 3 themselves.

## Contact me!

Finally, if there's anything that can be made clearer about the scripts and how they operate, please don't hesitate to email me at daniel.villarreal@canterbury.ac.nz.
